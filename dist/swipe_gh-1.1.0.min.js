/*! swipe_gh - v1.1.0 - 2020-05-13 */
function Swipe(){this.id=obj.id,this.bgimg=obj.bgimg,this._w=obj._w,this._h=obj._h,this.radius=obj.radius,this.posX=0,this.posY=0,this.isMouseDown=!1,this.coverType=obj.coverType,this.mask=obj.mask,this.percent=obj.percent,this.callback=obj.callback,this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop,this.scrollLeft=document.documentElement.scrollLeft||document.body.scrollLeft,this.scratch(),this.init(),this.addEvent()}Swipe.prototype.scratch=function(){this.dom=document.createElement("canvas"),this.dom.setAttribute("class",this.id),this.dom.setAttribute("width",this._w),this.dom.setAttribute("height",this._h),this.dom.setAttribute("style","background:url("+this.bgimg+");background-size: cover;"),this.context=this.dom.getContext("2d"),swipe.appendChild(this.dom)},Swipe.prototype.init=function(){var t,e;"color"===this.coverType&&(this.context.fillStyle=this.mask,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out"),"img"===this.coverType&&((t=new Image).src=this.mask,e=this,t.onload=function(){e.context.drawImage(t,0,0,t.width,t.height,0,0,e._w,e._h),e.context.globalCompositeOperation="destination-out"})},Swipe.prototype.addEvent=function(){this.o=this.getAllOffset(this.dom),this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.clickEvent=this.device?"touchstart":"mousedown",this.moveEvent=this.device?"touchmove":"mousemove",this.endEvent=this.device?"touchend":"mouseup";var o=this;this.dom.addEventListener(this.clickEvent,function(t){var e=t||window.event;o.scrollTop=document.documentElement.scrollTop||document.body.scrollTop,o.scrollLeft=document.documentElement.scrollLeft||document.body.scrollLeft,o.posX=o.device?e.touches[0].clientX:e.clientX,o.posY=o.device?e.touches[0].clientY:e.clientY,o.drawArc(o.posX-o.o.allLeft+o.scrollLeft,o.posY-o.o.allTop+o.scrollTop),o.isMouseDown=!0}),this.dom.addEventListener(this.moveEvent,function(t){if(!o.isMouseDown)return!1;var e=t||window.event;o.drawLine(o.postX-o.o.allLeft+o.scrollLeft,o.posY-o.o.allTop+o.scrollTop,o.x2-o.o.allLeft+o.scrollLeft,o.y2-o.o.allTop+o.scrollTop),o.x2=o.device?e.touches[0].clientX:e.clientX,o.y2=o.device?e.touches[0].clientY:e.clientY}),this.dom.addEventListener(this.endEvent,function(t){o.isMouseDown=!1;var e=o.getPercent();o.callback.call(null,e),e>o.percent&&o.context.clearRect(0,0,o._w,o._h)})},Swipe.prototype.drawArc=function(t,e){this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.stroke(),this.context.restore()},Swipe.prototype.drawLine=function(t,e,o,i){this.context.save(),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(o,i),this.context.lineWidth=2*this.radius,this.context.lineCap="round",this.context.strokeStyle="rgb(255,125,40)",this.context.stroke(),this.context.restore()},Swipe.prototype.getPercent=function(){this.num=0,this.imgData=this.context.getImageData(0,0,this._w,this._h);for(var t=0;t<this.imgData.data.length;t+=4)0===this.imgData.data[t+3]&&this.num++;return this.transpercent=this.num/(this._w*this._h)*100,console.log("透明点占总面积的百分比："+this.transpercent.toFixed(2)+"%"),this.transpercent},Swipe.prototype.getAllOffset=function(t){for(var e=0,o=0;t;)e+=t.offsetTop+t.clientTop,o+=t.offsetLeft+t.clientLeft,t=t.offsetParent;return{allTop:e,allLeft:o}};